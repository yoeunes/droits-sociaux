{% assign direction = site.language_data[site.lang].direction | default: 'ltr' %}
{% assign other_lang = site.languages | where_exp: "l", "l != site.lang" | first %}
{% assign current_url = page.url %}
{% if current_url == '/ar/' or current_url == '/ar' %}
  {% assign path_without_lang = '' %}
{% else %}
  {% assign path_without_lang = current_url | replace: '/ar/', '/' | replace: '//', '/' %}
{% endif %}
{% if other_lang == site.default_lang %}
  {% if path_without_lang == '' or path_without_lang == '/' %}
    {% assign switch_url = '/' %}
  {% else %}
    {% assign switch_url = path_without_lang %}
  {% endif %}
{% else %}
  {% if path_without_lang == '' or path_without_lang == '/' %}
    {% assign switch_url = '/ar/' %}
  {% else %}
    {% assign switch_url = path_without_lang | prepend: '/ar' %}
  {% endif %}
{% endif %}

<header class="fixed top-0 left-0 right-0 z-50">
  <!-- Top bar with trust indicators -->
  <div class="bg-footer text-footer-text text-xs py-2 hidden lg:block">
    <div class="container-custom flex items-center justify-between">
      <div class="flex items-center gap-6">
        <span class="flex items-center gap-1.5">
          <i class="fa-solid fa-shield-halved text-safe"></i>
          {% t header.secure_platform %}
        </span>
        <span class="flex items-center gap-1.5">
          <i class="fa-solid fa-circle-check text-safe"></i>
          {% t header.free_service %}
        </span>
      </div>
      <div class="flex items-center gap-4">
        <a href="{{ switch_url }}" class="flex items-center gap-1.5 hover:text-white transition-colors font-tajawal">
          <i class="fa-solid fa-globe"></i>
          {% t lang_switch %}
        </a>
      </div>
    </div>
  </div>

  <!-- Main navigation -->
  <nav class="bg-white border-b border-surface-border shadow-soft">
    <div class="container-custom">
      <div class="flex items-center justify-between h-16 lg:h-18">
        <!-- Logo -->
        <a href="{% tl home %}" class="flex items-center gap-3 group">
          <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center shadow-soft group-hover:shadow-medium transition-shadow">
            <img src="{{ '/assets/img/logo.png' | relative_url }}" alt="Logo" class="h-6 w-6 object-contain">
          </div>
          <div class="hidden sm:block">
            <span class="font-bold text-content text-sm tracking-tight">{% t site_name %}</span>
            <span class="block text-xs text-content-subtle">{% t site_tagline %}</span>
          </div>
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center gap-1">
          <a href="{% tl home %}" class="nav-link text-content hover:text-primary hover:bg-surface-subtle">
            {% t nav.home %}
          </a>

          <!-- News Dropdown -->
          <div class="relative group">
            <button class="nav-link text-content hover:text-primary hover:bg-surface-subtle flex items-center gap-1.5">
              {% t nav.news %}
              <i class="fa-solid fa-chevron-down text-[10px] text-content-subtle group-hover:text-primary transition-transform group-hover:rotate-180"></i>
            </button>
            <div class="nav-dropdown {% if direction == 'rtl' %}right-0 left-auto{% endif %}">
              <div class="py-2">
                <a href="{% tl actualites-cnss %}" class="nav-dropdown-item flex items-center gap-3">
                  <span class="w-8 h-8 bg-cnss-light rounded-lg flex items-center justify-center">
                    <img src="{{ '/assets/img/cnss_logo.png' | relative_url }}" alt="CNSS" class="h-5 object-contain">
                  </span>
                  <span>{% t nav.news_cnss %}</span>
                </a>
                <a href="{% tl actualites-cmr %}" class="nav-dropdown-item flex items-center gap-3">
                  <span class="w-8 h-8 bg-cmr-light rounded-lg flex items-center justify-center">
                    <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="CMR" class="h-5 object-contain">
                  </span>
                  <span>{% t nav.news_cmr %}</span>
                </a>
                <a href="{% tl actualites-cnops %}" class="nav-dropdown-item flex items-center gap-3">
                  <span class="w-8 h-8 bg-cnops-light rounded-lg flex items-center justify-center">
                    <img src="{{ '/assets/img/cnops_logo.png' | relative_url }}" alt="CNOPS" class="h-5 object-contain">
                  </span>
                  <span>{% t nav.news_cnops %}</span>
                </a>
              </div>
            </div>
          </div>

          <!-- Simulators Dropdown -->
          <div class="relative group">
            <button class="nav-link text-content hover:text-primary hover:bg-surface-subtle flex items-center gap-1.5">
              {% t nav.simulators %}
              <i class="fa-solid fa-chevron-down text-[10px] text-content-subtle group-hover:text-primary transition-transform group-hover:rotate-180"></i>
            </button>
            <div class="nav-dropdown w-72 {% if direction == 'rtl' %}right-0 left-auto{% endif %}">
              <div class="p-3">
                <div class="text-xs font-semibold text-content-subtle uppercase tracking-wider px-3 py-2">
                  {% t nav.pension_section %}
                </div>
                <a href="{% tl simulateurs/cnss %}" class="nav-dropdown-item flex items-center gap-3 rounded-lg">
                  <span class="w-10 h-10 bg-cnss-light rounded-xl flex items-center justify-center">
                    <img src="{{ '/assets/img/cnss_logo.png' | relative_url }}" alt="CNSS" class="h-6 object-contain">
                  </span>
                  <div>
                    <span class="block font-medium">{% t nav.pension_cnss %}</span>
                    <span class="text-xs text-content-subtle">{% t nav.pension_cnss_desc %}</span>
                  </div>
                </a>
                <a href="{% tl simulateurs/cmr %}" class="nav-dropdown-item flex items-center gap-3 rounded-lg">
                  <span class="w-10 h-10 bg-cmr-light rounded-xl flex items-center justify-center">
                    <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="CMR" class="h-6 object-contain">
                  </span>
                  <div>
                    <span class="block font-medium">{% t nav.pension_cmr %}</span>
                    <span class="text-xs text-content-subtle">{% t nav.pension_cmr_desc %}</span>
                  </div>
                </a>

                <div class="border-t border-surface-border my-2"></div>

                <div class="text-xs font-semibold text-content-subtle uppercase tracking-wider px-3 py-2">
                  {% t nav.amo_section %}
                </div>
                <a href="{% tl simulateurs/amo-cnss %}" class="nav-dropdown-item flex items-center gap-3 rounded-lg">
                  <span class="w-10 h-10 bg-cnss-light rounded-xl flex items-center justify-center">
                    <i class="fa-solid fa-heart-pulse text-cnss"></i>
                  </span>
                  <div>
                    <span class="block font-medium">{% t nav.amo_cnss %}</span>
                    <span class="text-xs text-content-subtle">{% t nav.amo_cnss_desc %}</span>
                  </div>
                </a>
                <a href="{% tl simulateurs/amo-cnops %}" class="nav-dropdown-item flex items-center gap-3 rounded-lg">
                  <span class="w-10 h-10 bg-cnops-light rounded-xl flex items-center justify-center">
                    <i class="fa-solid fa-heart-pulse text-cnops"></i>
                  </span>
                  <div>
                    <span class="block font-medium">{% t nav.amo_cnops %}</span>
                    <span class="text-xs text-content-subtle">{% t nav.amo_cnops_desc %}</span>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <a href="{% tl about %}" class="nav-link text-content hover:text-primary hover:bg-surface-subtle">
            {% t nav.about %}
          </a>
          <a href="{% tl contact %}" class="nav-link text-content hover:text-primary hover:bg-surface-subtle">
            {% t nav.contact %}
          </a>
        </div>

        <!-- Desktop Actions -->
        <div class="hidden lg:flex items-center gap-3">
          <a href="{% tl simulateurs/cnss %}" class="btn btn-primary gap-2">
            <i class="fa-solid fa-calculator"></i>
            {% t nav.start_simulation %}
          </a>
        </div>

        <!-- Mobile Menu Button -->
        <button id="mobile-menu-btn" class="lg:hidden w-10 h-10 flex items-center justify-center text-content hover:bg-surface-subtle rounded-xl transition-colors">
          <i class="fa-solid fa-bars text-lg"></i>
        </button>
      </div>
    </div>
  </nav>
</header>

<!-- Mobile Menu -->
<div id="mobile-menu" class="fixed inset-0 top-0 bg-white z-[60] transform translate-x-full transition-transform duration-300 lg:hidden overflow-y-auto">
  <!-- Mobile Header -->
  <div class="sticky top-0 bg-white border-b border-surface-border px-5 py-4 flex items-center justify-between">
    <a href="{% tl home %}" class="flex items-center gap-3">
      <div class="w-10 h-10 bg-primary rounded-xl flex items-center justify-center">
        <img src="{{ '/assets/img/logo.png' | relative_url }}" alt="Logo" class="h-6 w-6 object-contain">
      </div>
      <span class="font-bold text-content">{% t site_name %}</span>
    </a>
    <button id="mobile-menu-close" class="w-10 h-10 flex items-center justify-center text-content hover:bg-surface-subtle rounded-xl transition-colors">
      <i class="fa-solid fa-xmark text-xl"></i>
    </button>
  </div>

  <!-- Mobile Navigation -->
  <div class="p-5 space-y-2">
    <a href="{% tl home %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-content hover:bg-surface-subtle font-medium transition-colors">
      <i class="fa-solid fa-house w-5 text-content-subtle"></i>
      {% t nav.home %}
    </a>

    <!-- News Dropdown -->
    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-xl text-content hover:bg-surface-subtle font-medium transition-colors" onclick="toggleMobileDropdown(this)">
        <span class="flex items-center gap-3">
          <i class="fa-solid fa-newspaper w-5 text-content-subtle"></i>
          {% t nav.news %}
        </span>
        <i class="fa-solid fa-chevron-down text-sm text-content-subtle transition-transform duration-200"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-8{% else %}pl-8{% endif %} space-y-1 mt-2">
        <a href="{% tl actualites-cnss %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cnss transition-colors">
          <span class="w-6 h-6 bg-cnss-light rounded-md flex items-center justify-center">
            <img src="{{ '/assets/img/cnss_logo.png' | relative_url }}" alt="CNSS" class="h-4 object-contain">
          </span>
          {% t nav.news_cnss %}
        </a>
        <a href="{% tl actualites-cmr %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cmr transition-colors">
          <span class="w-6 h-6 bg-cmr-light rounded-md flex items-center justify-center">
            <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="CMR" class="h-4 object-contain">
          </span>
          {% t nav.news_cmr %}
        </a>
        <a href="{% tl actualites-cnops %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cnops transition-colors">
          <span class="w-6 h-6 bg-cnops-light rounded-md flex items-center justify-center">
            <img src="{{ '/assets/img/cnops_logo.png' | relative_url }}" alt="CNOPS" class="h-4 object-contain">
          </span>
          {% t nav.news_cnops %}
        </a>
      </div>
    </div>

    <!-- Simulators Dropdown -->
    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-xl text-content hover:bg-surface-subtle font-medium transition-colors" onclick="toggleMobileDropdown(this)">
        <span class="flex items-center gap-3">
          <i class="fa-solid fa-calculator w-5 text-content-subtle"></i>
          {% t nav.simulators %}
        </span>
        <i class="fa-solid fa-chevron-down text-sm text-content-subtle transition-transform duration-200"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-8{% else %}pl-8{% endif %} space-y-1 mt-2">
        <div class="px-4 py-2 text-xs text-content-subtle font-semibold uppercase tracking-wider">{% t nav.pension_section %}</div>
        <a href="{% tl simulateurs/cnss %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cnss transition-colors">
          <span class="w-6 h-6 bg-cnss-light rounded-md flex items-center justify-center">
            <img src="{{ '/assets/img/cnss_logo.png' | relative_url }}" alt="CNSS" class="h-4 object-contain">
          </span>
          {% t nav.pension_cnss %}
        </a>
        <a href="{% tl simulateurs/cmr %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cmr transition-colors">
          <span class="w-6 h-6 bg-cmr-light rounded-md flex items-center justify-center">
            <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="CMR" class="h-4 object-contain">
          </span>
          {% t nav.pension_cmr %}
        </a>
        <div class="border-t border-surface-border my-2 mx-4"></div>
        <div class="px-4 py-2 text-xs text-content-subtle font-semibold uppercase tracking-wider">{% t nav.amo_section %}</div>
        <a href="{% tl simulateurs/amo-cnss %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cnss transition-colors">
          <i class="fa-solid fa-heart-pulse w-6 text-center text-cnss"></i>
          {% t nav.amo_cnss %}
        </a>
        <a href="{% tl simulateurs/amo-cnops %}" class="flex items-center gap-3 px-4 py-2.5 rounded-lg text-content-muted hover:bg-surface-subtle hover:text-cnops transition-colors">
          <i class="fa-solid fa-heart-pulse w-6 text-center text-cnops"></i>
          {% t nav.amo_cnops %}
        </a>
      </div>
    </div>

    <a href="{% tl about %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-content hover:bg-surface-subtle font-medium transition-colors">
      <i class="fa-solid fa-circle-info w-5 text-content-subtle"></i>
      {% t nav.about %}
    </a>
    <a href="{% tl contact %}" class="flex items-center gap-3 px-4 py-3 rounded-xl text-content hover:bg-surface-subtle font-medium transition-colors">
      <i class="fa-solid fa-envelope w-5 text-content-subtle"></i>
      {% t nav.contact %}
    </a>

    <!-- Mobile Actions -->
    <div class="pt-4 mt-4 border-t border-surface-border space-y-3">
      <a href="{% tl simulateurs/cnss %}" class="btn btn-primary w-full justify-center gap-2">
        <i class="fa-solid fa-calculator"></i>
        {% t nav.start_simulation %}
      </a>
      <a href="{{ switch_url }}" class="btn btn-outline w-full justify-center gap-2 font-tajawal">
        <i class="fa-solid fa-globe"></i>
        {% t lang_switch %}
      </a>
    </div>

    <!-- Trust indicators -->
    <div class="pt-6 mt-4 border-t border-surface-border">
      <div class="flex items-center justify-center gap-6 text-xs text-content-subtle">
        <span class="flex items-center gap-1.5">
          <i class="fa-solid fa-shield-halved text-safe"></i>
          {% t header.secure_platform %}
        </span>
        <span class="flex items-center gap-1.5">
          <i class="fa-solid fa-circle-check text-safe"></i>
          {% t header.free_service %}
        </span>
      </div>
    </div>
  </div>
</div>
