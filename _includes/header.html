{% assign lang = page.lang | default: 'fr' %}
{% assign t = site.data.i18n[lang] %}
{% assign nav = site.data.navigation %}
{% assign direction = page.direction | default: 'ltr' %}
{% capture lang_switch_url %}/{{ t.other_lang }}/{{ page.url | split: '/' | last }}{% endcapture %}
{% capture base_url %}/{{ lang }}/{% endcapture %}

<nav class="fixed top-0 left-0 right-0 bg-footer z-50 shadow-lg">
  <div class="container-custom">
    <div class="flex items-center justify-between h-16">
      <a href="{{ base_url }}{{ nav.home }}" class="flex items-center text-white font-bold">
        <img src="{{ '/assets/img/logo.png' | relative_url }}" alt="Logo" class="h-8 {% if direction == 'rtl' %}ml-3{% else %}mr-3{% endif %}">
        <span class="hidden sm:inline">{{ t.site_name }}</span>
      </a>

      <div class="hidden lg:flex items-center space-x-1 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <a href="{{ base_url }}{{ nav.home }}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">
          {{ t.nav.home }}
        </a>

        <div class="relative group">
          <button class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium flex items-center">
            {{ t.nav.news }}
            <i class="fa-solid fa-chevron-down text-xs {% if direction == 'rtl' %}mr-2{% else %}ml-2{% endif %}"></i>
          </button>
          <div class="absolute top-full {% if direction == 'rtl' %}right-0{% else %}left-0{% endif %} mt-1 w-48 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 overflow-hidden">
            {% for item in nav.news %}
            {% assign news_key = 'news_' | append: item.id %}
            <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">
              {{ t.nav[news_key] }}
            </a>
            {% endfor %}
          </div>
        </div>

        <div class="relative group">
          <button class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium flex items-center">
            {{ t.nav.simulators }}
            <i class="fa-solid fa-chevron-down text-xs {% if direction == 'rtl' %}mr-2{% else %}ml-2{% endif %}"></i>
          </button>
          <div class="absolute top-full {% if direction == 'rtl' %}right-0{% else %}left-0{% endif %} mt-1 w-56 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 overflow-hidden">
            <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-b">
              {{ t.nav.pension_section }}
            </div>
            {% for item in nav.simulators.pension %}
            {% assign pension_key = 'pension_' | append: item.id %}
            <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">
              {{ t.nav[pension_key] }}
            </a>
            {% endfor %}
            <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-t border-b">
              {{ t.nav.amo_section }}
            </div>
            {% for item in nav.simulators.amo %}
            {% assign amo_key = 'amo_' | append: item.id %}
            <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">
              {{ t.nav[amo_key] }}
            </a>
            {% endfor %}
          </div>
        </div>

        <a href="{{ base_url }}{{ nav.about }}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">
          {{ t.nav.about }}
        </a>

        <a href="{{ base_url }}{{ nav.contact }}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">
          {{ t.nav.contact }}
        </a>
      </div>

      <div class="hidden lg:flex items-center space-x-4 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <div class="flex items-center space-x-3 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors">
            <i class="fa-brands fa-facebook text-lg"></i>
          </a>
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors">
            <i class="fa-brands fa-youtube text-lg"></i>
          </a>
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors">
            <i class="fa-brands fa-whatsapp text-lg"></i>
          </a>
        </div>

        <a href="{{ lang_switch_url }}" class="px-3 py-1.5 border border-footer-border rounded-lg text-footer-text hover:bg-footer-border hover:text-white transition-colors font-tajawal">
          {{ t.lang_switch }}
        </a>
      </div>

      <button id="mobile-menu-btn" class="lg:hidden text-white p-2">
        <i class="fa-solid fa-bars text-xl"></i>
      </button>
    </div>
  </div>
</nav>

<div id="mobile-menu" class="fixed inset-0 top-16 bg-white z-40 transform translate-x-full transition-transform duration-300 lg:hidden overflow-y-auto">
  <div class="p-4 space-y-2">
    <a href="{{ base_url }}{{ nav.home }}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
      {{ t.nav.home }}
    </a>

    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium" onclick="toggleMobileDropdown(this)">
        {{ t.nav.news }}
        <i class="fa-solid fa-chevron-down text-sm transition-transform"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-4{% else %}pl-4{% endif %} space-y-1 mt-1">
        {% for item in nav.news %}
        {% assign news_key = 'news_' | append: item.id %}
        <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">
          {{ t.nav[news_key] }}
        </a>
        {% endfor %}
      </div>
    </div>

    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium" onclick="toggleMobileDropdown(this)">
        {{ t.nav.simulators }}
        <i class="fa-solid fa-chevron-down text-sm transition-transform"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-4{% else %}pl-4{% endif %} space-y-1 mt-1">
        <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase">{{ t.nav.pension_section }}</div>
        {% for item in nav.simulators.pension %}
        {% assign pension_key = 'pension_' | append: item.id %}
        <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">
          {{ t.nav[pension_key] }}
        </a>
        {% endfor %}
        <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-t mt-2 pt-2">{{ t.nav.amo_section }}</div>
        {% for item in nav.simulators.amo %}
        {% assign amo_key = 'amo_' | append: item.id %}
        <a href="{{ base_url }}{{ item.page }}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">
          {{ t.nav[amo_key] }}
        </a>
        {% endfor %}
      </div>
    </div>

    <a href="{{ base_url }}{{ nav.about }}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
      {{ t.nav.about }}
    </a>

    <a href="{{ base_url }}{{ nav.contact }}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">
      {{ t.nav.contact }}
    </a>

    <div class="border-t pt-4 mt-4 flex items-center justify-between px-4">
      <a href="{{ lang_switch_url }}" class="px-4 py-2 border border-gray-200 rounded-lg text-gray-700 font-tajawal font-medium hover:bg-gray-50 transition-colors">
        {{ t.lang_switch }}
      </a>
      <div class="flex items-center space-x-4 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-facebook text-lg"></i></a>
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-youtube text-lg"></i></a>
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-whatsapp text-lg"></i></a>
      </div>
    </div>
  </div>
</div>
