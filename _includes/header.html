{% assign direction = site.language_data[site.lang].direction | default: 'ltr' %}
{% assign other_lang = site.languages | where_exp: "l", "l != site.lang" | first %}

<nav class="fixed top-0 left-0 right-0 bg-footer z-50 shadow-lg">
  <div class="container-custom">
    <div class="flex items-center justify-between h-16">
      <a href="{% tl home %}" class="flex items-center text-white font-bold">
        <img src="{{ '/assets/img/logo.png' | relative_url }}" alt="Logo" class="h-8 {% if direction == 'rtl' %}ml-3{% else %}mr-3{% endif %}">
        <span class="hidden sm:inline">{% t site_name %}</span>
      </a>

      <div class="hidden lg:flex items-center space-x-1 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <a href="{% tl home %}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">
          {% t nav.home %}
        </a>

        <div class="relative group">
          <button class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium flex items-center">
            {% t nav.news %}
            <i class="fa-solid fa-chevron-down text-xs {% if direction == 'rtl' %}mr-2{% else %}ml-2{% endif %}"></i>
          </button>
          <div class="absolute top-full {% if direction == 'rtl' %}right-0{% else %}left-0{% endif %} mt-1 w-48 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 overflow-hidden">
            <a href="{% tl actualites-cnss %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">{% t nav.news_cnss %}</a>
            <a href="{% tl actualites-cmr %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cmr font-medium">{% t nav.news_cmr %}</a>
            <a href="{% tl actualites-cnops %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnops font-medium">{% t nav.news_cnops %}</a>
          </div>
        </div>

        <div class="relative group">
          <button class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium flex items-center">
            {% t nav.simulators %}
            <i class="fa-solid fa-chevron-down text-xs {% if direction == 'rtl' %}mr-2{% else %}ml-2{% endif %}"></i>
          </button>
          <div class="absolute top-full {% if direction == 'rtl' %}right-0{% else %}left-0{% endif %} mt-1 w-56 bg-white rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 overflow-hidden">
            <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-b">{% t nav.pension_section %}</div>
            <a href="{% tl simulateurs/cnss %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">{% t nav.pension_cnss %}</a>
            <a href="{% tl simulateurs/cmr %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cmr font-medium">{% t nav.pension_cmr %}</a>
            <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-t border-b">{% t nav.amo_section %}</div>
            <a href="{% tl simulateurs/amo-cnss %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnss font-medium">{% t nav.amo_cnss %}</a>
            <a href="{% tl simulateurs/amo-cnops %}" class="block px-4 py-3 text-gray-700 hover:bg-gray-50 hover:text-cnops font-medium">{% t nav.amo_cnops %}</a>
          </div>
        </div>

        <a href="{% tl about %}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">{% t nav.about %}</a>
        <a href="{% tl contact %}" class="px-4 py-2 text-footer-text hover:text-white transition-colors font-medium">{% t nav.contact %}</a>
      </div>

      <div class="hidden lg:flex items-center space-x-4 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <div class="flex items-center space-x-3 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors"><i class="fa-brands fa-facebook text-lg"></i></a>
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors"><i class="fa-brands fa-youtube text-lg"></i></a>
          <a href="#" target="_blank" class="text-footer-text hover:text-white transition-colors"><i class="fa-brands fa-whatsapp text-lg"></i></a>
        </div>

        <a href="/{{ other_lang }}{{ page.url | remove_first: '/' | remove_first: site.lang | prepend: '/' }}" class="px-3 py-1.5 border border-footer-border rounded-lg text-footer-text hover:bg-footer-border hover:text-white transition-colors font-tajawal">
          {% t lang_switch %}
        </a>
      </div>

      <button id="mobile-menu-btn" class="lg:hidden text-white p-2">
        <i class="fa-solid fa-bars text-xl"></i>
      </button>
    </div>
  </div>
</nav>

<div id="mobile-menu" class="fixed inset-0 top-16 bg-white z-40 transform translate-x-full transition-transform duration-300 lg:hidden overflow-y-auto">
  <div class="p-4 space-y-2">
    <a href="{% tl home %}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">{% t nav.home %}</a>

    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium" onclick="toggleMobileDropdown(this)">
        {% t nav.news %}
        <i class="fa-solid fa-chevron-down text-sm transition-transform"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-4{% else %}pl-4{% endif %} space-y-1 mt-1">
        <a href="{% tl actualites-cnss %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.news_cnss %}</a>
        <a href="{% tl actualites-cmr %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.news_cmr %}</a>
        <a href="{% tl actualites-cnops %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.news_cnops %}</a>
      </div>
    </div>

    <div class="mobile-dropdown">
      <button class="w-full flex items-center justify-between px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium" onclick="toggleMobileDropdown(this)">
        {% t nav.simulators %}
        <i class="fa-solid fa-chevron-down text-sm transition-transform"></i>
      </button>
      <div class="hidden {% if direction == 'rtl' %}pr-4{% else %}pl-4{% endif %} space-y-1 mt-1">
        <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase">{% t nav.pension_section %}</div>
        <a href="{% tl simulateurs/cnss %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.pension_cnss %}</a>
        <a href="{% tl simulateurs/cmr %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.pension_cmr %}</a>
        <div class="px-4 py-2 text-xs text-gray-400 font-bold uppercase border-t mt-2 pt-2">{% t nav.amo_section %}</div>
        <a href="{% tl simulateurs/amo-cnss %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.amo_cnss %}</a>
        <a href="{% tl simulateurs/amo-cnops %}" class="block px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-50">{% t nav.amo_cnops %}</a>
      </div>
    </div>

    <a href="{% tl about %}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">{% t nav.about %}</a>
    <a href="{% tl contact %}" class="block px-4 py-3 rounded-lg text-gray-700 hover:bg-gray-50 font-medium">{% t nav.contact %}</a>

    <div class="border-t pt-4 mt-4 flex items-center justify-between px-4">
      <a href="/{{ other_lang }}{{ page.url | remove_first: '/' | remove_first: site.lang | prepend: '/' }}" class="px-4 py-2 border border-gray-200 rounded-lg text-gray-700 font-tajawal font-medium hover:bg-gray-50 transition-colors">
        {% t lang_switch %}
      </a>
      <div class="flex items-center space-x-4 {% if direction == 'rtl' %}space-x-reverse{% endif %}">
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-facebook text-lg"></i></a>
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-youtube text-lg"></i></a>
        <a href="#" class="text-gray-500 hover:text-cnss transition-colors"><i class="fa-brands fa-whatsapp text-lg"></i></a>
      </div>
    </div>
  </div>
</div>
