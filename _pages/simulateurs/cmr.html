---
layout: simulateur
title: simulators.cmr.meta_title
namespace: simulateurs/cmr
permalink: /simulateurs/cmr/
hero_title_key: simulators.cmr.hero_title
hero_description_key: simulators.cmr.hero_description
warning_text_key: simulators.cmr.warning
official_link: "https://www.cmr.gov.ma"
cta_link: articles/methode-calcul-cmr
cta_title_key: simulators.cmr.cta_title
cta_text_key: simulators.cmr.cta_text
---
{% assign direction = site.language_data[site.lang].direction | default: 'ltr' %}

<!-- Simulator Header -->
<div class="simulator-header">
  <div class="simulator-logo bg-cmr-light">
    <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="Logo CMR">
  </div>
  <p class="simulator-subtitle">{% t simulators.cmr.subtitle %}</p>
</div>

<!-- Simulator Form -->
<form id="cmr-form" class="simulator-form">
  <!-- Years Before 2017 -->
  <div class="form-group">
    <label for="years-before" class="form-label">
      <i class="fa-solid fa-clock-rotate-left text-cmr"></i>
      {% t simulators.cmr.years_before %}
    </label>
    <div class="input-with-suffix">
      <input
        type="number"
        id="years-before"
        class="form-input form-input-cmr"
        placeholder="15"
        value="0"
        min="0"
        oninput="calculate()"
      >
      <span class="input-suffix">{% t common.years %}</span>
    </div>
    <p class="form-helper">
      <i class="fa-solid fa-circle-info"></i>
      {% t simulators.cmr.years_before_helper %}
    </p>
  </div>

  <!-- Years After 2017 -->
  <div class="form-group">
    <label for="years-after" class="form-label">
      <i class="fa-solid fa-calendar-check text-cmr"></i>
      {% t simulators.cmr.years_after %}
    </label>
    <div class="input-with-suffix">
      <input
        type="number"
        id="years-after"
        class="form-input form-input-cmr"
        placeholder="8"
        value="0"
        min="0"
        oninput="calculate()"
      >
      <span class="input-suffix">{% t common.years %}</span>
    </div>
    <p class="form-helper">
      <i class="fa-solid fa-circle-info"></i>
      {% t simulators.cmr.years_after_helper %}
    </p>
  </div>

  <!-- Last Salary -->
  <div class="form-group">
    <label for="salary" class="form-label">
      <i class="fa-solid fa-money-bill-wave text-cmr"></i>
      {% t simulators.cmr.salary %}
    </label>
    <div class="input-with-suffix">
      <input
        type="number"
        id="salary"
        class="form-input form-input-cmr"
        placeholder="12000"
        min="0"
        oninput="calculate()"
      >
      <span class="input-suffix">MAD</span>
    </div>
  </div>

  <!-- Retirement Type -->
  <div class="form-group">
    <label for="retirement-type" class="form-label">
      <i class="fa-solid fa-user-clock text-cmr"></i>
      {% t simulators.cmr.retirement_type %}
    </label>
    <select id="retirement-type" class="form-input form-input-cmr" onchange="calculate()">
      <option value="normal">{% t simulators.cmr.normal %}</option>
      <option value="early">{% t simulators.cmr.early %}</option>
    </select>
  </div>
</form>

<!-- Results Container -->
<div id="result" class="simulator-results hidden"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const LABELS = {
  pension: "{% t simulators.cmr.pension %}",
  rate: "{% t simulators.cmr.rate %}",
  salaryRef: "{% t simulators.cmr.salary_ref %}",
  years: "{% t simulators.cmr.years %}",
  download: "{% t common.download_pdf %}",
  share: "{% t common.share %}",
  perMonth: "{% t common.per_month %}",
  rateBefore: "{% t simulators.cmr.rate_before %}",
  rateAfter: "{% t simulators.cmr.rate_after %}"
};

let pdfData = {};

function calculate() {
  const yearsBefore = parseInt(document.getElementById('years-before').value) || 0;
  const yearsAfter = parseInt(document.getElementById('years-after').value) || 0;
  const salary = parseFloat(document.getElementById('salary').value) || 0;
  const retirementType = document.getElementById('retirement-type').value;
  const resultDiv = document.getElementById('result');

  if (salary <= 0 || (yearsBefore + yearsAfter) <= 0) {
    resultDiv.classList.add('hidden');
    return;
  }

  const rateBefore = 2.5;
  const rateAfter = retirementType === 'normal' ? 2 : 1.5;
  const totalRate = Math.min((yearsBefore * rateBefore) + (yearsAfter * rateAfter), 100);
  const pension = salary * (totalRate / 100);

  pdfData = {
    yearsBefore: yearsBefore,
    yearsAfter: yearsAfter,
    salary: salary.toFixed(2),
    totalRate: totalRate.toFixed(2),
    pension: pension.toFixed(2),
    retirementType: retirementType === 'normal' ? 'Normal' : 'AnticipÃ©'
  };

  resultDiv.innerHTML = `
    <div class="result-grid grid-cols-1 sm:grid-cols-2">
      <!-- Main Result -->
      <div class="result-card-primary bg-cmr sm:col-span-2">
        <div class="relative">
          <i class="fa-solid fa-sack-dollar result-icon"></i>
          <span class="result-label">${LABELS.pension}</span>
          <strong class="result-value">${pension.toFixed(2)} <span class="text-lg">MAD</span></strong>
          <span class="block text-xs opacity-75 mt-1">${LABELS.perMonth}</span>
        </div>
      </div>

      <!-- Total Rate -->
      <div class="result-card-secondary">
        <i class="fa-solid fa-percent text-2xl text-cmr mb-3"></i>
        <span class="block text-sm text-content-muted mb-1">${LABELS.rate}</span>
        <strong class="text-xl font-bold text-cmr">${totalRate.toFixed(2)}%</strong>
      </div>

      <!-- Years of Service -->
      <div class="result-card-secondary">
        <i class="fa-solid fa-calendar-days text-2xl text-cmr mb-3"></i>
        <span class="block text-sm text-content-muted mb-1">${LABELS.years}</span>
        <strong class="text-xl font-bold text-cmr">${yearsBefore + yearsAfter}</strong>
      </div>

      <!-- Salary Reference -->
      <div class="result-card-secondary">
        <i class="fa-solid fa-money-bill-wave text-2xl text-cmr mb-3"></i>
        <span class="block text-sm text-content-muted mb-1">${LABELS.salaryRef}</span>
        <strong class="text-xl font-bold text-cmr">${salary.toFixed(2)} MAD</strong>
      </div>

      <!-- Rate Details -->
      <div class="result-card-secondary">
        <i class="fa-solid fa-chart-simple text-2xl text-cmr mb-3"></i>
        <div class="text-xs text-content-muted space-y-1">
          <p>${LABELS.rateBefore}: <strong class="text-cmr">${rateBefore}%</strong></p>
          <p>${LABELS.rateAfter}: <strong class="text-cmr">${rateAfter}%</strong></p>
        </div>
      </div>
    </div>

    <div class="result-actions">
      <button onclick="generatePDF()" class="btn bg-red-600 hover:bg-red-700 text-white gap-2">
        <i class="fa-solid fa-file-pdf"></i>
        ${LABELS.download}
      </button>
      <a href="https://api.whatsapp.com/send?text=${encodeURIComponent(window.location.href)}" target="_blank" rel="noopener" class="btn bg-emerald-600 hover:bg-emerald-700 text-white gap-2">
        <i class="fa-brands fa-whatsapp"></i>
        ${LABELS.share}
      </a>
    </div>
  `;
  resultDiv.classList.remove('hidden');
}

function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const now = new Date();
  const ref = `CMR-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}`;

  // Header
  doc.setFillColor(45, 125, 125);
  doc.rect(0, 0, 210, 45, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(24);
  doc.setFont(undefined, 'bold');
  doc.text('Estimation Pension CMR', 105, 28, { align: 'center' });

  // Reference and date
  doc.setTextColor(60, 60, 60);
  doc.setFontSize(10);
  doc.setFont(undefined, 'normal');
  doc.text(`Date: ${now.toLocaleDateString('fr-FR')}`, 20, 58);
  doc.text(`Reference: ${ref}`, 150, 58);

  doc.setDrawColor(220, 220, 220);
  doc.line(20, 65, 190, 65);

  // Data section
  const data = [
    ['Annees avant 2017', pdfData.yearsBefore + ' ans'],
    ['Annees apres 2017', pdfData.yearsAfter + ' ans'],
    ['Salaire de reference', pdfData.salary + ' DH'],
    ['Type de retraite', pdfData.retirementType],
    ['Taux total', pdfData.totalRate + '%']
  ];

  let y = 80;
  doc.setFontSize(11);
  data.forEach(([label, value]) => {
    doc.setFont(undefined, 'normal');
    doc.setTextColor(100, 100, 100);
    doc.text(label + ':', 20, y);
    doc.setFont(undefined, 'bold');
    doc.setTextColor(45, 125, 125);
    doc.text(String(value), 90, y);
    y += 12;
  });

  // Result box
  doc.setFillColor(240, 249, 249);
  doc.roundedRect(20, y + 10, 170, 50, 5, 5, 'F');
  doc.setFontSize(12);
  doc.setTextColor(100, 100, 100);
  doc.setFont(undefined, 'normal');
  doc.text('Pension Mensuelle Estimee', 105, y + 28, { align: 'center' });
  doc.setFontSize(32);
  doc.setTextColor(45, 125, 125);
  doc.setFont(undefined, 'bold');
  doc.text(pdfData.pension + ' DH', 105, y + 48, { align: 'center' });

  // Warning
  doc.setFillColor(255, 251, 235);
  doc.roundedRect(20, y + 70, 170, 25, 3, 3, 'F');
  doc.setFontSize(9);
  doc.setTextColor(146, 64, 14);
  doc.setFont(undefined, 'normal');
  doc.text('AVERTISSEMENT: Ce document est une estimation indicative.', 105, y + 82, { align: 'center' });
  doc.text('Il ne constitue pas un document officiel de la CMR.', 105, y + 90, { align: 'center' });

  // Footer
  doc.setFontSize(8);
  doc.setTextColor(150, 150, 150);
  doc.text('Simulateurs Sociaux Maroc - Plateforme independante d\'information', 105, 280, { align: 'center' });

  doc.save(`estimation-cmr-${ref}.pdf`);
}

document.addEventListener('DOMContentLoaded', function() {
  calculate();
});
</script>
