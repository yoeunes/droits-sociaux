---
layout: simulateur
lang: fr
direction: ltr
title: "Simulateur Pension CMR - Maroc"
hero_title: "Simulateur Pension CMR"
hero_description: "Estimez votre retraite du secteur public (Fonctionnaires) selon les regles de la reforme 2017."
warning_text: "Ce resultat est une estimation indicative. Il ne remplace pas le calcul officiel de la CMR."
official_link: "https://www.cmr.gov.ma"
show_cta: true
cta_title: "Comment ca marche ?"
cta_text: "Voir la methode de calcul detaillee"
cta_link: "/fr/articles/methode-calcul-cmr.html"
---

<div class="text-center mb-8">
  <img src="{{ '/assets/img/cmr_logo.png' | relative_url }}" alt="Logo CMR" class="h-16 mx-auto mb-4">
</div>

<div id="terms-modal" class="fixed inset-0 bg-white/95 backdrop-blur-sm z-50 flex items-center justify-center p-4">
  <div class="bg-white w-full max-w-md p-8 rounded-2xl shadow-xl border-t-4 border-cmr">
    <div class="text-cmr mb-4">
      <i class="fa-solid fa-shield-halved text-4xl"></i>
    </div>
    <h3 class="text-xl font-bold text-cmr mb-2">Conditions d'utilisation</h3>
    <p class="text-gray-600 mb-6">
      Cette plateforme est <strong>independante</strong> et ne represente pas la CMR.
      Les resultats sont fournis a titre indicatif.
    </p>
    <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg mb-6 cursor-pointer" onclick="document.getElementById('accept-check').click()">
      <input type="checkbox" id="accept-check" class="w-5 h-5 text-cmr rounded" onclick="event.stopPropagation(); toggleAccept()">
      <label for="accept-check" class="text-sm text-gray-700">
        J'ai lu et j'accepte les <a href="/fr/conditions.html" target="_blank" class="text-cmr underline">conditions d'utilisation</a>.
      </label>
    </div>
    <button id="btn-accept" class="w-full px-6 py-3 bg-cmr text-white font-semibold rounded-lg hover:bg-cmr-dark transition-all disabled:bg-gray-300 disabled:cursor-not-allowed" onclick="acceptTerms()" disabled>
      Acceder au simulateur
    </button>
  </div>
</div>

<form id="cmr-form" class="space-y-6">
  <div>
    <label for="start-date" class="form-label">Date de recrutement (debut de service) :</label>
    <input type="date" id="start-date" class="form-input" onchange="calculate()" oninput="calculate()">
  </div>

  <div>
    <label for="end-date" class="form-label">Date de depart a la retraite (prevue) :</label>
    <input type="date" id="end-date" class="form-input" onchange="calculate()" oninput="calculate()">
  </div>

  <div>
    <label for="salary" class="form-label">Salaire moyen des 8 dernieres annees (MAD) :</label>
    <input type="number" id="salary" class="form-input" placeholder="Ex: 12000" oninput="calculate()">
    <p class="text-sm text-gray-500 mt-2">Moyenne des 96 derniers mois (Salaire de reference).</p>
  </div>

  <div class="flex items-center gap-3 p-4 bg-gray-50 rounded-lg">
    <input type="checkbox" id="is-anticipe" class="w-5 h-5 text-cmr rounded" onchange="calculate()">
    <label for="is-anticipe" class="text-gray-700 font-medium cursor-pointer">Depart anticipe (Retraite proportionnelle)</label>
  </div>
</form>

<div id="result" class="mt-8 hidden"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
let pdfData = {};
const STORAGE_KEY = 'cmr_terms_accepted';

function toggleAccept() {
  document.getElementById('btn-accept').disabled = !document.getElementById('accept-check').checked;
}

function acceptTerms() {
  localStorage.setItem(STORAGE_KEY, 'true');
  const modal = document.getElementById('terms-modal');
  modal.style.opacity = '0';
  setTimeout(() => modal.style.display = 'none', 300);
}

function checkTermsAccepted() {
  if (localStorage.getItem(STORAGE_KEY) === 'true') {
    document.getElementById('terms-modal').style.display = 'none';
  }
}

function calculate() {
  const startDateVal = document.getElementById('start-date').value;
  const endDateVal = document.getElementById('end-date').value;
  const salaryVal = parseFloat(document.getElementById('salary').value) || 0;
  const isAnticipe = document.getElementById('is-anticipe').checked;
  const resultDiv = document.getElementById('result');

  if (!startDateVal || !endDateVal || salaryVal <= 0) {
    resultDiv.classList.add('hidden');
    return;
  }

  const startDate = new Date(startDateVal);
  const endDate = new Date(endDateVal);

  if (startDate >= endDate) {
    resultDiv.innerHTML = `<div class="p-6 bg-red-50 text-red-700 rounded-lg text-center"><strong>Erreur :</strong> La date de retraite doit etre posterieure a la date de recrutement.</div>`;
    resultDiv.classList.remove('hidden');
    return;
  }

  const reformDate = new Date('2017-01-01');
  let anneesAvantReforme = 0;
  let anneesApresReforme = 0;

  if (startDate < reformDate) {
    const endAvant = (endDate < reformDate) ? endDate : reformDate;
    anneesAvantReforme = (endAvant - startDate) / (1000 * 60 * 60 * 24 * 365.25);
    if (endDate > reformDate) {
      anneesApresReforme = (endDate - reformDate) / (1000 * 60 * 60 * 24 * 365.25);
    }
  } else {
    anneesApresReforme = (endDate - startDate) / (1000 * 60 * 60 * 24 * 365.25);
  }

  const totalAnnuitesDecimal = anneesAvantReforme + anneesApresReforme;
  const totalAnnees = Math.floor(totalAnnuitesDecimal);
  const totalMois = Math.round((totalAnnuitesDecimal - totalAnnees) * 12);

  const tauxAvant = anneesAvantReforme > 0 ? anneesAvantReforme * 2.5 : 0;
  let tauxApres = 0;
  if (anneesApresReforme > 0) {
    const facteur = isAnticipe ? 1.5 : 2.0;
    tauxApres = anneesApresReforme * facteur;
  }

  let tauxTotal = tauxAvant + tauxApres;
  let msgPlafond = "";
  if (tauxTotal > 100) {
    tauxTotal = 100;
    msgPlafond = " (Plafond atteint)";
  }

  let pensionCalculee = (salaryVal * tauxTotal) / 100;
  let msgMin = "Calcul standard selon la reforme 2017.";

  if (totalAnnuitesDecimal >= 10) {
    if (pensionCalculee < 1500) {
      pensionCalculee = 1500;
      msgMin = "Minimum garanti applique (1500 DH pour 10+ ans de service).";
    }
  } else if (totalAnnuitesDecimal >= 5) {
    if (pensionCalculee < 1000) {
      pensionCalculee = 1000;
      msgMin = "Minimum garanti applique (1000 DH pour 5-10 ans de service).";
    }
  } else {
    msgMin = "Attention : Moins de 5 ans de service. Verifiez votre eligibilite.";
  }

  pdfData = {
    start: startDateVal,
    end: endDateVal,
    salary: salaryVal.toFixed(2) + " DH",
    duration: `${totalAnnees} ans ${totalMois} mois`,
    rate: tauxTotal.toFixed(2) + "%",
    pension: pensionCalculee.toFixed(2) + " DH"
  };

  resultDiv.innerHTML = `
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div class="bg-cmr text-white p-6 rounded-xl text-center">
        <i class="fa-solid fa-sack-dollar text-2xl mb-2"></i>
        <span class="block text-sm opacity-90">Pension estimee</span>
        <strong class="text-2xl bg-white text-cmr px-4 py-1 rounded-full mt-2 inline-block">${pensionCalculee.toFixed(2)} MAD</strong>
      </div>
      <div class="bg-white border p-6 rounded-xl text-center">
        <i class="fa-solid fa-percent text-2xl text-cmr mb-2"></i>
        <span class="block text-sm text-gray-500">Taux de pension</span>
        <strong class="text-xl text-cmr">${tauxTotal.toFixed(2)}%${msgPlafond}</strong>
      </div>
      <div class="bg-white border p-6 rounded-xl text-center">
        <i class="fa-solid fa-money-bill-wave text-2xl text-cmr mb-2"></i>
        <span class="block text-sm text-gray-500">Salaire reference</span>
        <strong class="text-xl text-cmr">${salaryVal.toFixed(2)} MAD</strong>
      </div>
      <div class="bg-white border p-6 rounded-xl text-center">
        <i class="fa-solid fa-briefcase text-2xl text-cmr mb-2"></i>
        <span class="block text-sm text-gray-500">Anciennete</span>
        <strong class="text-xl text-cmr">${totalAnnees} ans ${totalMois} mois</strong>
      </div>
    </div>
    <p class="text-sm text-gray-600 bg-gray-50 p-4 rounded-lg mb-6"><strong>Note :</strong> ${msgMin}</p>
    <div class="flex flex-col sm:flex-row gap-3">
      <button onclick="generatePDF()" class="flex-1 px-6 py-3 bg-red-600 hover:bg-red-700 text-white font-semibold rounded-lg transition-all inline-flex items-center justify-center">
        <i class="fa-solid fa-file-pdf mr-2"></i> Telecharger le resultat (PDF)
      </button>
      <a href="https://api.whatsapp.com/send?text=Je viens de calculer ma retraite CMR sur ce site gratuit !" target="_blank" class="flex-1 px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-semibold rounded-lg transition-all inline-flex items-center justify-center">
        <i class="fa-brands fa-whatsapp mr-2"></i> Partager
      </a>
    </div>
  `;
  resultDiv.classList.remove('hidden');
}

function generatePDF() {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  const now = new Date();
  const ref = `CMR-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}`;

  doc.setFillColor(0, 128, 128);
  doc.rect(0, 0, 210, 40, 'F');
  doc.setTextColor(255, 255, 255);
  doc.setFontSize(22);
  doc.text('Resultat de Simulation', 105, 20, { align: 'center' });
  doc.setFontSize(12);
  doc.text('Simulateurs Sociaux Maroc - CMR', 105, 30, { align: 'center' });

  doc.setTextColor(0, 0, 0);
  doc.setFontSize(11);
  doc.text(`Date: ${now.toLocaleDateString('fr-FR')}`, 20, 55);
  doc.text(`Ref: ${ref}`, 150, 55);

  doc.setDrawColor(200);
  doc.line(20, 60, 190, 60);

  const data = [
    ['Date de recrutement:', pdfData.start],
    ['Date de retraite:', pdfData.end],
    ['Salaire de reference:', pdfData.salary],
    ['Anciennete:', pdfData.duration],
    ['Taux applique:', pdfData.rate]
  ];

  let y = 75;
  data.forEach(([label, value]) => {
    doc.setFont(undefined, 'bold');
    doc.text(label, 20, y);
    doc.setFont(undefined, 'normal');
    doc.setTextColor(0, 128, 128);
    doc.text(value, 90, y);
    doc.setTextColor(0, 0, 0);
    y += 12;
  });

  doc.setFillColor(224, 242, 241);
  doc.rect(20, y + 10, 170, 40, 'F');
  doc.setFontSize(12);
  doc.setTextColor(100);
  doc.text('Pension Mensuelle Estimee', 105, y + 25, { align: 'center' });
  doc.setFontSize(28);
  doc.setTextColor(0, 128, 128);
  doc.text(pdfData.pension, 105, y + 42, { align: 'center' });

  doc.setFillColor(255, 248, 225);
  doc.rect(20, y + 60, 170, 30, 'F');
  doc.setFontSize(9);
  doc.setTextColor(133, 100, 4);
  doc.text('AVERTISSEMENT: Ce document est une estimation indicative.', 105, y + 72, { align: 'center' });
  doc.text('Il ne constitue pas un document officiel et n\'a aucune valeur juridique aupres de la CMR.', 105, y + 80, { align: 'center' });

  doc.setFontSize(8);
  doc.setTextColor(150);
  doc.text('Simulateurs Sociaux Maroc - Plateforme independante', 105, 280, { align: 'center' });

  doc.save(`estimation-cmr-${ref}.pdf`);
}

document.addEventListener('DOMContentLoaded', function() {
  checkTermsAccepted();
  calculate();
});
</script>
